$(document).ready(function(){function t(t){switch(window.searchType){case"C":o=window.oipaApiUrl+"activities/?hierarchy=1&page_size=10&format=json&reporting_organisation=GB-1&fields=activity_status,iati_identifier,url,title,reporting_organisations,activity_plus_child_aggregation,description&activity_status="+$("#activity_status_states").val()+"&ordering="+$("#sort_results_type").val()+"&activity_plus_child_aggregation_budget_value_gte="+$("#budget_lower_bound").val()+"&activity_plus_child_aggregation_budget_value_lte="+$("#budget_higher_bound").val()+"&actual_start_date_gte="+$("#date_lower_bound").val()+"&planned_end_date_lte="+$("#date_higher_bound").val()+"&sector="+$("#selected_sectors").val()+"&related_activity_recipient_country="+window.CountryCode;break;case"F":o=window.oipaApiUrl+"activities/?hierarchy=1&page_size=10&format=json&fields=activity_status,iati_identifier,url,title,reporting_organisations,activity_plus_child_aggregation,description&q="+window.searchQuery+"&activity_status="+$("#activity_status_states").val()+"&ordering="+$("#sort_results_type").val()+"&activity_plus_child_aggregation_budget_value_gte="+$("#budget_lower_bound").val()+"&activity_plus_child_aggregation_budget_value_lte="+$("#budget_higher_bound").val()+"&actual_start_date_gte="+$("#date_lower_bound").val()+"&planned_end_date_lte="+$("#date_higher_bound").val()+"&sector="+$("#selected_sectors").val()+"&reporting_organisation_startswith=GB";break;case"S":o=window.oipaApiUrl+"activities/?hierarchy=1&page_size=10&format=json&reporting_organisation=GB-1&fields=activity_status,iati_identifier,url,title,reporting_organisations,activity_plus_child_aggregation,description&activity_status="+$("#activity_status_states").val()+"&ordering="+$("#sort_results_type").val()+"&activity_plus_child_aggregation_budget_value_gte="+$("#budget_lower_bound").val()+"&activity_plus_child_aggregation_budget_value_lte="+$("#budget_higher_bound").val()+"&actual_start_date_gte="+$("#date_lower_bound").val()+"&planned_end_date_lte="+$("#date_higher_bound").val()+"&sector="+$("#selected_sectors").val()+"&related_activity_sector="+window.SectorCode+"&recipient_country="+$("#locationCountryFilterStates").val()+"&recipient_region="+$("#locationRegionFilterStates").val();break;case"R":o=window.oipaApiUrl+"activities/?hierarchy=1&page_size=10&format=json&reporting_organisation=GB-1&fields=activity_status,iati_identifier,url,title,reporting_organisations,activity_plus_child_aggregation,description&activity_status="+$("#activity_status_states").val()+"&ordering="+$("#sort_results_type").val()+"&activity_plus_child_aggregation_budget_value_gte="+$("#budget_lower_bound").val()+"&activity_plus_child_aggregation_budget_value_lte="+$("#budget_higher_bound").val()+"&actual_start_date_gte="+$("#date_lower_bound").val()+"&planned_end_date_lte="+$("#date_higher_bound").val()+"&sector="+$("#selected_sectors").val()+"&related_activity_recipient_region="+window.RegionCode}}function e(){$(".sort-proj-sectors").each(function(){$(this).css("border","none")})}function i(t){$("#light-pagination").pagination({items:t,itemsOnPage:10,cssStyle:"compact-theme",onPageClick:function(e,i){pagedOipaLink=o+"&page="+e,$.getJSON(pagedOipaLink,{format:"json"}).done(function(i){if($("#showResults").html(""),r(i.next)){var a="<div>Now showing projects "+(1+10*(e-1))+" - "+t+" of "+t+"</div>";$("#showResults").append(a)}else{var a='<div>Now showing projects <span name="afterFilteringAmount" style="display:inline;"></span><span id="numberofResults" value="" style="display:inline;">'+(1+10*(e-1))+" - "+10*e+"</span> of "+t+"</div>";$("#showResults").append(a)}$.each(i.results,function(t,e){var i={};i.iati_identifier=r(e.iati_identifier)?"":e.iati_identifier,r(e.title.narratives)?i.title="":r(e.title.narratives[0].text)?i.title="":i.title=e.title.narratives[0].text,i.total_plus_child_budget_value=r(e.activity_plus_child_aggregation.budget_value)?0:e.activity_plus_child_aggregation.budget_value,i.activity_status=r(e.activity_status.name)?"":e.activity_status.name,r(e.reporting_organisations)?i.reporting_organisations="":r(e.reporting_organisations[0].narratives)?i.reporting_organisations="":i.reporting_organisations=e.reporting_organisations[0].narratives[0].text,r(e.description)?i.description="":r(e.description[0].narratives)?i.description="":i.description=e.description[0].narratives[0].text;var a='<div class="search-result"><h3><a href="/projects/'+i.iati_identifier+'">'+i.title+" <small>["+i.iati_identifier+']</small></a></h3><span class="budget">Budget: <em> £'+n(i.total_plus_child_budget_value)+"</em></span><span>Status: <em>"+i.activity_status+"</em></span><span>Reporting Org: <em>"+i.reporting_organisations+'</em></span><p class="description">'+i.description+"</p></div>";$("#showResults").append(a)})}).fail(function(t){$("#showResults").text(t.toSource()),console.log("AJAX error in request: "+JSON.stringify(t,null,2))})}})}function a(t){$.getJSON(t,{format:"json"}).done(function(t){if($("#showResults").html(""),l=t.count,i(t.count),r(t.next)){var e="<div>Now showing projects "+l+" of "+l+"</div>";$("#showResults").append(e)}else{var e='<div>Now showing projects <span name="afterFilteringAmount" style="display:inline;"></span><span id="numberofResults" value="" style="display:inline;">1 - 10</span> of '+l+"</div>";$("#showResults").append(e)}$.each(t.results,function(t,e){var i={};i.iati_identifier=r(e.iati_identifier)?"":e.iati_identifier,r(e.title.narratives)?i.title="":r(e.title.narratives[0].text)?i.title="":i.title=e.title.narratives[0].text,i.total_plus_child_budget_value=r(e.activity_plus_child_aggregation.budget_value)?0:e.activity_plus_child_aggregation.budget_value,i.activity_status=r(e.activity_status.name)?"":e.activity_status.name,r(e.reporting_organisations)?i.reporting_organisations="":r(e.reporting_organisations[0].narratives)?i.reporting_organisations="":i.reporting_organisations=e.reporting_organisations[0].narratives[0].text,r(e.description)?i.description="":r(e.description[0].narratives)?i.description="":i.description=e.description[0].narratives[0].text;var a='<div class="search-result"><h3><a href="/projects/'+i.iati_identifier+'">'+i.title+" <small>["+i.iati_identifier+']</small></a></h3><span class="budget">Budget: <em> £'+n(i.total_plus_child_budget_value)+"</em></span><span>Status: <em>"+i.activity_status+"</em></span><span>Reporting Org: <em>"+i.reporting_organisations+'</em></span><p class="description">'+i.description+"</p></div>";$("#showResults").append(a)})}).fail(function(t){console.log("AJAX error in request: "+JSON.stringify(t,null,2))})}function s(){$(".proj-filter-exp-collapse-sign").click(function(){"+"==$(this).text()?($(this).text("-"),$(this).parent().find("div[name=countries]").show("slow"),$(this).parent().find("div[name=regions]").show("slow"),$(this).parent().find("ul").show("slow")):($(this).text("+"),$(this).parent().find("div[name=countries]").hide("slow"),$(this).parent().find("div[name=regions]").hide("slow"),$(this).parent().find("ul").hide("slow"))}),$(".proj-filter-exp-collapse-text").click(function(){$(this).parent().find(".proj-filter-exp-collapse-sign").each(function(){"+"==$(this).text()?($(this).text("-"),$(this).parent().find("div[name=countries]").show("slow"),$(this).parent().find("div[name=regions]").show("slow"),$(this).parent().find("ul").show("slow")):($(this).text("+"),$(this).parent().find("div[name=countries]").hide("slow"),$(this).parent().find("div[name=regions]").hide("slow"),$(this).parent().find("ul").hide("slow"))})})}function n(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function r(t){return void 0===t||null==t||t.length<=0?!0:!1}i(window.project_count);var o="";switch(window.searchType){case"C":o=window.oipaApiUrl+"activities/?hierarchy=1&page_size=10&format=json&reporting_organisation=GB-1&fields=activity_status,iati_identifier,url,title,reporting_organisations,activity_plus_child_aggregation,description&activity_status="+$("#activity_status_states").val()+"&ordering="+$("#sort_results_type").val()+"&activity_plus_child_aggregation_budget_value_gte="+$("#budget_lower_bound").val()+"&activity_plus_child_aggregation_budget_value_lte="+$("#budget_higher_bound").val()+"&actual_start_date_gte="+$("#date_lower_bound").val()+"&planned_end_date_lte="+$("#date_higher_bound").val()+"&sector="+$("#selected_sectors").val()+"&related_activity_recipient_country="+window.CountryCode;break;case"F":o=window.oipaApiUrl+"activities/?hierarchy=1&page_size=10&format=json&fields=activity_status,iati_identifier,url,title,reporting_organisations,activity_plus_child_aggregation,description&q="+window.searchQuery+"&activity_status="+$("#activity_status_states").val()+"&ordering="+$("#sort_results_type").val()+"&activity_plus_child_aggregation_budget_value_gte="+$("#budget_lower_bound").val()+"&activity_plus_child_aggregation_budget_value_lte="+$("#budget_higher_bound").val()+"&actual_start_date_gte="+$("#date_lower_bound").val()+"&planned_end_date_lte="+$("#date_higher_bound").val()+"&sector="+$("#selected_sectors").val()+"&reporting_organisation_startswith=GB";break;case"S":o=window.oipaApiUrl+"activities/?hierarchy=1&page_size=10&format=json&reporting_organisation=GB-1&fields=activity_status,iati_identifier,url,title,reporting_organisations,activity_plus_child_aggregation,description&activity_status="+$("#activity_status_states").val()+"&ordering="+$("#sort_results_type").val()+"&activity_plus_child_aggregation_budget_value_gte="+$("#budget_lower_bound").val()+"&activity_plus_child_aggregation_budget_value_lte="+$("#budget_higher_bound").val()+"&actual_start_date_gte="+$("#date_lower_bound").val()+"&planned_end_date_lte="+$("#date_higher_bound").val()+"&sector="+$("#selected_sectors").val()+"&related_activity_sector="+window.SectorCode+"&recipient_country="+$("#locationCountryFilterStates").val()+"&recipient_region="+$("#locationRegionFilterStates").val();break;case"R":o=window.oipaApiUrl+"activities/?hierarchy=1&page_size=10&format=json&reporting_organisation=GB-1&fields=activity_status,iati_identifier,url,title,reporting_organisations,activity_plus_child_aggregation,description&activity_status="+$("#activity_status_states").val()+"&ordering="+$("#sort_results_type").val()+"&activity_plus_child_aggregation_budget_value_gte="+$("#budget_lower_bound").val()+"&activity_plus_child_aggregation_budget_value_lte="+$("#budget_higher_bound").val()+"&actual_start_date_gte="+$("#date_lower_bound").val()+"&planned_end_date_lte="+$("#date_higher_bound").val()+"&sector="+$("#selected_sectors").val()+"&related_activity_recipient_region="+window.RegionCode}var l=0;$("#sortProjTitle").on("click",function(i){"▼"==$(this).text()?($("#sort_results_type").val("title"),t(window.searchType),a(o),$(this).text("▲")):($("#sort_results_type").val("-title"),t(window.searchType),a(o),$(this).text("▼")),e(),$(this).css("border","solid 1px #FFA500"),i.preventDefault()}),$("#sortProjBudg").click(function(i){"▼"==$(this).text()?($("#sort_results_type").val("activity_plus_child_budget_value"),t(window.searchType),a(o),$(this).text("▲")):($("#sort_results_type").val("-activity_plus_child_budget_value"),t(window.searchType),a(o),$(this).text("▼")),e(),$(this).css("border","solid 1px #FFA500"),i.preventDefault()}),$(".activity_status").click(function(){var e=$(".activity_status:checked").map(function(){return $(this).val()}).get().join();e.length>0?$("#activity_status_states").val(e):$("#activity_status_states").val("1,2,3,4,5"),t(window.searchType),a(o)}),$(".sector").click(function(){var e=$(".sector:checked").map(function(){return $(this).val()}).get().join();$("#selected_sectors").val(e),t(window.searchType),a(o)}),$(".location_country").click(function(){var e=$(".location_country:checked").map(function(){return $(this).val()}).get().join();$("#locationCountryFilterStates").val(e),t(window.searchType),a(o)}),$(".location_region").click(function(){var e=$(".location_region:checked").map(function(){return $(this).val()}).get().join();$("#locationRegionFilterStates").val(e),t(window.searchType),a(o)}),$("#slider-vertical").slider({orientation:"horizontal",range:!0,min:0,max:window.maxBudget,step:100*Math.round(window.maxBudget/100)/100,values:[0,window.maxBudget],slide:function(t,e){$("#amount").html("£"+n(e.values[0])+" - £"+n(e.values[1]))},change:function(e,i){$("#budget_lower_bound").val(i.values[0]),$("#budget_higher_bound").val(i.values[1]),t(window.searchType),a(o)}}),$("#amount").html("£"+n($("#slider-vertical").slider("values",0))+" - £"+n($("#slider-vertical").slider("values",1))),StartDt=new Date(window.StartDate.slice(0,10)),EndDt=new Date(window.EndDate.slice(0,10)),$("#date-slider-vertical").slider({orientation:"horizontal",range:!0,min:Date.parse(StartDt),max:Date.parse(EndDt),step:864e5,values:[Date.parse(StartDt),Date.parse(EndDt)],slide:function(t,e){var i=new Date(e.values[0]),a=new Date(e.values[1]);$("#date-range").html(i.customFormat("#DD# #MMM# #YYYY#")+" - "+a.customFormat("#DD# #MMM# #YYYY#"))},change:function(e,i){var s=new Date(i.values[0]),n=new Date(i.values[1]);$("#date_lower_bound").val(s.customFormat("#YYYY#-#MM#-#DD#")),$("#date_higher_bound").val(n.customFormat("#YYYY#-#MM#-#DD#")),t(window.searchType),a(o)}}),$("#date-range").html(StartDt.customFormat("#DD# #MMM# #YYYY#")+" - "+EndDt.customFormat("#DD# #MMM# #YYYY#")),s(),$(document).ajaxStart(function(){$(".modal").show()}),$(document).ajaxStop(function(){$(".modal").hide()})});