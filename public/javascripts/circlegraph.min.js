CircleGraph=function(t){this.drawRegionalProjectsGraph=function(e,i,r){this.clearContainer();var n=.13*this.width,a=.22*this.width;this.drawCentralCircle(n,.2*n,e,"/"+r);var s,l,o,c,h=d3.max(i.regionalProjects.map(function(t){return t.budget})),d=d3.min(i.regionalProjects.map(function(t){return t.budget}));i.regionalProjects.length<4?(s=.12*this.width,l=.12*this.width,o=.24*l,c=.3*l):(s=.12*this.width,l=.12*this.width,o=.24*l,c=.34*l);var p=d3.scale.linear();p.domain([d,h]),p.range([o,c]),plots=i.regionalProjects.length,increase=2*Math.PI/plots,angle=15,x=0,y=0;for(var g=0;g<plots;g++){var m=p(i.regionalProjects[g].budget),u=new SateliteCircle(t,"element_"+g,i.regionalProjects[g],s,l,m);x=a*Math.cos(angle)+this.width/2+.13*n,y=a*Math.sin(angle)+this.height/2,u.position(x,y),function(){var t=u.getData().code;$(u.getElement()).click(function(){window.location="/regions/"+t})}(),angle+=increase}},this.clearContainer=function(){$(t.selector+" svg").remove(),$(t.selector+" div").remove(),this.width=t.width(),this.height=.55*this.width},this.drawCentralCircle=function(e,i,r,n){var a=this.width/2-e,s=this.height/2-e-i,l=.13*e,o=2*l,c=d3.select(t.selector).append("svg").append("g").attr("transform","translate("+a+", "+s+")"),h=c.append("circle").style("fill","#008270").style("opacity","0.7").style("cursor","pointer").attr("r",e).attr("cx",e).attr("cy",e);c.append("text").attr("text-anchor","middle").attr("fill","#FFF").attr("transform","translate("+e+", "+e+")").style("font-size",l+"px").style("line-height","1.1em").append("tspan").text(r.header).attr("x","0").attr("dy","-0.3em").on("click",function(){n&&(window.location=n)}).style("cursor","pointer").append("tspan").text(r.amount).attr("x","0").attr("dy","1em").style("font-size",o+"px").on("click",function(){n&&(window.location=n)}).style("cursor","pointer");n&&h.on("click",function(){window.location=n}).style("cursor","pointer")},this.drawOuterCentralCircle=function(e){var i=this.width/2-e,r=this.height/2-e,n=d3.select(t.selector+" svg").append("g").attr("transform","translate("+i+", "+r+")");n.append("circle").style("stroke","gray").style("fill","transparent").style("z-index","-1").attr("r",e).attr("cx",e).attr("cy",e)}},SateliteCircle=function(t,e,i,r,n,a){this.data=i,this.position=function(t,e){this.elm.style.left=t-r/2+"px",this.elm.style.top=e-n/2+"px",this.x=t,this.y=e},this.elm=document.createElement("div"),this.elm.style.cursor="pointer",this.elm.style.position="absolute",this.elm.id=e,this.elm.style.width=r+"px",this.elm.style.height=n+"px",this.elm.style.overflow="visible",this.width=r,this.height=n,t.append(this.elm);var s=d3.select("#"+this.elm.id).append("svg").append("g");s.append("circle").style("fill","#008270").style("opacity","0.7").style("cursor","pointer").attr("r",a).attr("cx",r/2).attr("cy",a);var l=.35*a;l>7&&s.append("text").attr("text-anchor","middle").attr("fill","#FFF").attr("transform","translate("+r/2+", "+1.2*a+")").style("font-size",l+"px").style("line-height","1.1em").style("cursor","pointer").append("tspan").text(format_million_stg(i.budget)),s.append("text").attr("text-anchor","middle").attr("transform","translate("+r/2+", "+2.6*a+")").style("font-size","10px").style("line-height","1.2em").append("tspan").text(i.region).attr("x","0").attr("dy","0")},SateliteCircle.prototype.getElement=function(){return this.elm},SateliteCircle.prototype.getData=function(){return this.data},format_million_stg=function(t){return"Â£"+(t/1e6).toFixed(2)+"m"};