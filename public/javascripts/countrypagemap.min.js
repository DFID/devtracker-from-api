$(document).ready(function(){!function(t,e){function a(t,e){var a={radius:6,fillColor:"#a04567",color:"#000",weight:1,opacity:1,fillOpacity:.8,id:t,title:e};return a}function o(t){for(var e=[],a=0;a<t.length;a++){var o=t[a];e.push(["<div class='row'>","<div class='five columns location-label'>","<a href='/projects/",o.id,"'>",o.id,"</a>","</div>","<div class='seven columns'>",o.title,"</div>","</div>"].join(""))}return["<div class='location-popup large'>",e.join(""),"</div>"].join("")}var r,n=$("#countryName").val(),i=$("#countryCode").val(),s=$("#projectType").val(),p=(L.tileLayer("http://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{maxZoom:10,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, Tiles courtesy of <a href="http://hot.openstreetmap.org/" target="_blank">Humanitarian OpenStreetMap Team</a>'}),'Tiles &copy; <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png" />'),l=(L.tileLayer("http://otile{s}.mqcdn.com/tiles/1.0.0/{type}/{z}/{x}/{y}.png",{options:{subdomains:"1234",type:"osm",attribution:"Map data "+L.TileLayer.OSM_ATTR+", "+p}}),L.tileLayer("http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'}),L.tileLayer("https://api.mapbox.com/v4/mapbox.emerald/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZGV2dHJhY2tlciIsImEiOiJjaWhzdnplbzUwMDJ3dzRrcGVyN2licGFpIn0.a3sZ1t6v-N1nxFCDIiGblQ",{attribution:'&copy; <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}));if("global"==s)r=new L.Map("countryMap",{center:new L.LatLng(7.79,21.28),zoom:1,layers:[l]});else if(n&&i)null!=countryBounds[i][2]?zoomFactor=countryBounds[i][2]:zoomFactor=6,r=new L.Map("countryMap",{center:new L.LatLng(countryBounds[i][0],countryBounds[i][1]),zoom:zoomFactor,layers:[l]});else if(i){var c=regionBounds[i],u=new L.LatLngBounds(new L.LatLng(c.southwest.lat,c.southwest.lng),new L.LatLng(c.northeast.lat,c.northeast.lng));r=new L.Map("countryMap",{layers:[l]}),r.fitBounds(u),r.panInsideBounds(u)}else $("#countryMap").hide(),$("#countryMapDisclaimer").hide();if(r){var d=window.baseUrl+"activities/?format=json&reporting_organisation=GB-1&hierarchy=1&related_activity_recipient_country="+i+"&fields=title,iati_identifier,locations&page_size=500";$.getJSON(d,function(t){$(".modal_map_markers").show();var e=new L.MarkerClusterGroup({spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,singleMarkerMode:!0,maxClusterRadius:40,removeOutsideVisibleBounds:!1,iconCreateFunction:function(t){var e=t.getChildCount(),a="";return e>99&&(e="+",a="large-value"),new L.DivIcon({html:'<div class="marker cluster '+a+'">'+e+"</div>"})}});e.on("clusterclick",function(t){var e=t.target._zoom==t.target._maxZoom;if(e){for(var a=[],n=0;n<t.layer._markers.length;n++)a.push(t.layer._markers[n].options);var i=o(a);L.popup().setLatLng(t.layer._latlng).setContent(i).openOn(r)}}),t.results.forEach(function(t){var o=t.iati_identifier,r="http://devtracker.dfid.gov.uk/projects/"+o,n=null!=t.title.narratives?t.title.narratives[0].text:"";t.locations.forEach(function(t){var i=L.latLng(t.point.pos.latitude,t.point.pos.longitude),s=new L.circleMarker(i,a(o,n)),p=t.name[0].narratives[0].text;s.bindPopup("<a href='"+r+"'>"+n+" ("+o+")</a><br />"+p),e.addLayer(s)})}),r.addLayer(e)}).done(function(){$(".modal_map_markers").hide()})}}(this)});