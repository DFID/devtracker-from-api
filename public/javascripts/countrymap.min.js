(function(m,n){function l(e){for(var a=[],b=0;b<e.length;b++){var c=e[b];a.push(["<div class='row'><div class='five columns location-label'><a href='/projects/",c.id,"'>",c.id,"</a></div><div class='seven columns'>",c.title,"</div></div>"].join(""))}return["<div class='location-popup large'>",a.join(""),"</div>"].join("")}var a=$("#countryName").val(),b=$("#countryCode").val(),g=$("#projectType").val(),c;L.tileLayer("http://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, Tiles courtesy of <a href="http://hot.openstreetmap.org/" target="_blank">Humanitarian OpenStreetMap Team</a>'}); L.tileLayer("http://otile{s}.mqcdn.com/tiles/1.0.0/{type}/{z}/{x}/{y}.png",{options:{subdomains:"1234",type:"osm",attribution:"Map data "+L.TileLayer.OSM_ATTR+', Tiles &copy; <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png" />'}});L.tileLayer("http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'}); var d=L.tileLayer("https://api.mapbox.com/v4/mapbox.emerald/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZGV2dHJhY2tlciIsImEiOiJjaWhzdnplbzUwMDJ3dzRrcGVyN2licGFpIn0.a3sZ1t6v-N1nxFCDIiGblQ",{attribution:'&copy; <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'});"global"==g?c=new L.Map("countryMap",{center:new L.LatLng(7.79,21.28),zoom:1,layers:[d]}):"country"==g&&a&&b?c=new L.Map("countryMap",{center:new L.LatLng(countryBounds[b][0], countryBounds[b][1]),zoom:countryBounds[b][2]||6,layers:[d]}):"region"==g&&b?(a=regionBounds[b],a=new L.LatLngBounds(new L.LatLng(a.southwest.lat,a.southwest.lng),new L.LatLng(a.northeast.lat,a.northeast.lng)),c=new L.Map("countryMap",{layers:[d]}),c.fitBounds(a),c.panInsideBounds(a)):($("#countryMap").hide(),$("#countryMapDisclaimer").hide());if(c&&m.locations){d=new L.MarkerClusterGroup({spiderfyOnMaxZoom:!1,showCoverageOnHover:!1,singleMarkerMode:!0,iconCreateFunction:function(a){a=a.getChildCount(); var b="";99<a&&(a="+",b="large-value");return new L.DivIcon({html:'<div class="marker cluster '+b+'">'+a+"</div>"})}});d.on("clusterclick",function(a){if(a.target._zoom==a.target._maxZoom){for(var b=[],d=0;d<a.layer._markers.length;d++)b.push(a.layer._markers[d].options.data);b=l(b);L.popup().setLatLng(a.layer._latlng).setContent(b).openOn(c)}});for(a=0;a<locations.length;a++){var b=locations[a],h,f;try{f=b.name[0].narratives[0].text}catch(e){f=ProjectTitle}try{h=new L.LatLng(b.point.pos.latitude, b.point.pos.longitude);var k=new L.Marker(h,{title:f});switch(mapType){case "country":k.bindPopup(l([b]));break;case "project":k.bindPopup(["<div class='location-popup'><div class='row'><div class='four columns location-label'> Name </div><div class='eight columns'>",f,"</div></div></div>"].join(""))}d.addLayer(k)}catch(e){h=new L.LatLng(0,0)}}c.addLayer(d)}})(this);