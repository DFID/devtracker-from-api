<div class="hero">
    <div id="page-title" class="row">
        <div class="twelve columns">
            <img src="/images/cw_ukaid_logo.png" alt="UK aid from the British people">
            <div>
                <div class="breadcrumb">
                    <ul>
                        <li><a href="/">Home</a></li>
                        <li><a href="/location/country/">Aid by Location</a></li>
                        <li><%= country[:name] %></li>
                    </ul>
                </div>
                <h1>
                    <%= country[:name] %>
                </h1>
            </div>
        </div>
    </div>

<%= erb :'partials/_countries-tabs', :locals => { :active => "donorStats", :country => country, :project_count => country[:totalProjects] } %>
</div>
<div class="row" style="margin-top: 20px">
    <div class="twelve columns">
      <h3 class="section-group-title">Donors Active Table</h3>
      <table id="donorProjects" class="display" style="width:100%">
        <thead>
          <tr>
            <th>Donor</th>
            <th>Active</th>
            <th>Implementation</th>
            <th>Closed</th>
          </tr>
        </thead>
        <tbody>
          <%donors.each do |donor, donorData|%>
            <tr>
              <td><%= donorData['name']%></td>
              <%if activeClosedProjectList.key?(donor)%>
                <%if activeClosedProjectList[donor]["active_projects"] > 0 %>
                  <td><span style="color: green">Yes</span></td>
                <%else%>
                  <td><span style="color: red">No</span></td>
                <%end%>
                <td><%= activeClosedProjectList[donor]["active_projects"] %></td>
                <td><%= activeClosedProjectList[donor]["closed_projects"] %></td>
              <%else%>
                <td><span style="color: red">No</span></td>
                <td>0</td>
                <td>0</td>
              <%end%>
            </tr>
          <%end%>
        </tbody>
        <!-- <tfoot>
            <tr>
              <th style="text-align:right">Total:</th>
              <th style="padding-left: 10px"></th>
            </tr>
        </tfoot> -->
      </table>
    </div>
</div>
<div class="row" style="margin-top: 20px">
    <div class="twelve columns">
      <h3 class="section-group-title">Donor Sector Data Table</h3>
      <%donors.each do |donor, donorData|%>
        <%if donorSectorData.key?(donor)%>
          <%if donorSectorData[donor].length > 0%>
            <h4><%= donorData['name']%></h4>
            <table class="donorSectorProjects" class="display" style="width:100%">
              <thead>
                <tr>
                  <th>Sectors</th>
                  <th>Count</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                <%donorSectorData[donor].each do |key, data|%>
                  <tr>
                    <td><%= data['name']%></td>
                    <td><%= data['sectorCount']%></td>
                    <td><%= Money.new(data['budget'].to_f*100,"GBP").format(:no_cents_if_whole => true,:sign_before_symbol => false)%></td>
                  </tr>
                <%end%>
              </tbody>
              <!-- <tfoot>
                  <tr>
                    <th style="text-align:right">Total:</th>
                    <th style="padding-left: 10px"></th>
                  </tr>
              </tfoot> -->
            </table>
          <%end%>
        <%end%>
      <%end%>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.3.1.js" type="text/javascript"></script>
<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
<script type="text/javascript">
  $(document).ready(function() {
    function addCommas(nStr){
        nStr += '';
        x = nStr.split('.');
        x1 = x[0];
        x2 = x.length > 1 ? '.' + x[1] : '';
        var rgx = /(\d+)(\d{3})/;
        while (rgx.test(x1)) {
            x1 = x1.replace(rgx, '$1' + ',' + '$2');
        }
        return x1 + x2;
    }
    $('#donorProjects').DataTable({
      "info": false,
      "paging": false,
      "searching": false
    });
    $('.donorSectorProjects').DataTable({
      "info": false,
      "paging": false,
      "searching": false
    });
  });
</script>